@inject ManageClient ManageClient
@inject Notify Notify

<Modal ConfirmLoading="_loading" Title="修改密码" Visible="_visible" OnCancel="() => _visible = false" OnOk="OnSave">
    <Card Title="@_user.Email">
        <ChildContent>
            <AntDesign.Input TValue="string" @bind-Value="_password"/>
        </ChildContent>
    </Card>
</Modal>


@code {

    private UserDto _user = new();

    private bool _loading;

    private bool _visible;

    private string _password = "";

    private Action? _callback;

    public void Show(UserDto userDto, Action? action)
    {
        _user = userDto;
        _callback = action;
        _visible = true;
        StateHasChanged();
    }

    private async void OnSave()
    {
        if (string.IsNullOrWhiteSpace(_password))
        {
            Notify.NoticeWithIcon("Warn", "密码不能为空", NotificationType.Warning);
            return;
        }

        _loading = true;
        var request = new ModifyPasswordDto() { UserId = _user.Id, UserEmail = _user.Email, NewPassword = _password, Website = _user.Website };
        var saveUser = await ManageClient.ModifyPassword(request);
        _loading = false;
        if (!saveUser)
        {
            Notify.NoticeWithIcon("Error", "修改密码失败", NotificationType.Error);
            StateHasChanged();
            return;
        }
        Notify.NoticeWithIcon("Error", "修改密码成功", NotificationType.Success);
        _callback?.Invoke();
        _visible = false;
        StateHasChanged();
    }

}